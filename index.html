<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa o≈õrodk√≥w narciarskich - 200km od Rybnika</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <!-- Marker clustering removed per user request -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header h1 {
            color: #2c3e50;
            font-size: 24px;
            margin-bottom: 5px;
        }
        .header p {
            color: #7f8c8d;
            font-size: 13px;
        }
        .stats {
            margin-top: 8px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        #search {
            padding: 8px 10px;
            border-radius: 8px;
            border: 1px solid #dfe6e9;
            font-size: 13px;
            width: 260px;
            background: white;
            box-shadow: 0 1px 4px rgba(0,0,0,0.06);
        }
        .stat {
            background: #3498db;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }
        #map {
            flex: 1;
            width: 100%;
        }
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            max-width: 320px;
        }
        .popup-content {
            padding: 5px;
        }
        .popup-content h3 {
            color: #2c3e50;
            margin: 0 0 8px 0;
            font-size: 18px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        .popup-content .info-row {
            margin: 8px 0;
            font-size: 13px;
            line-height: 1.5;
        }
        .popup-content .info-row strong {
            color: #2c3e50;
            display: inline-block;
            min-width: 80px;
        }
        .popup-content .level {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            margin: 3px 2px;
            color: white;
            font-weight: 600;
        }
        .beginner { background: #27ae60; }
        .intermediate { background: #3498db; }
        .advanced { background: #e74c3c; }
        .all-levels { background: #9b59b6; }
        .price-box {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 8px;
            margin: 8px 0;
            border-left: 4px solid #27ae60;
        }
        .price-box .price {
            font-size: 16px;
            font-weight: bold;
            color: #27ae60;
        }
        .price-box .price-label {
            font-size: 11px;
            color: #7f8c8d;
        }
        .distance {
            background: #ecf0f1;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            color: #34495e;
            display: inline-block;
            margin-top: 5px;
        }
        .btn-group {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        .website-btn, .map-btn {
            flex: 1;
            display: inline-block;
            padding: 8px 12px;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 12px;
            text-align: center;
            transition: all 0.3s;
            font-weight: 600;
        }
        .website-btn {
            background: #3498db;
        }
        .website-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        .map-btn {
            background: #e74c3c;
        }
        .map-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            max-width: 200px;
        }
        .legend h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #2c3e50;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
            font-size: 11px;
        }
        .legend-icon {
            width: 18px;
            height: 18px;
            margin-right: 8px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        @media (max-width: 768px) {
            .header h1 { font-size: 18px; }
            .stats { gap: 10px; }
            .stat { font-size: 11px; padding: 4px 10px; }
            .legend { bottom: 10px; right: 10px; padding: 10px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéø O≈õrodki Narciarskie - 200km od Rybnika</h1>
        <p>Wszystkie najlepsze stoki w promieniu 200 km z cenami i mapami tras</p>
        <div style="margin:8px 0">
            <input id="search" placeholder="Szukaj o≈õrodka (np. Szczyrk)" aria-label="Szukaj o≈õrodka" />
        </div>
        <div class="stats">
            <div class="stat" id="resort-count">üìç ... O≈õrodk√≥w</div>
            <div class="stat">‚õ∑Ô∏è 250+ km tras</div>
            <div class="stat">üé´ Ceny od 100 PLN</div>
        </div>
    </div>
    <div id="map"></div>
    <div class="legend">
        <h4>Poziom trudno≈õci</h4>
        <div class="legend-item">
            <div class="legend-icon beginner"></div>
            <span>PoczƒÖtkujƒÖcy</span>
        </div>
        <div class="legend-item">
            <div class="legend-icon intermediate"></div>
            <span>≈öredniozaawans.</span>
        </div>
        <div class="legend-item">
            <div class="legend-icon advanced"></div>
            <span>Zaawansowani</span>
        </div>
        <div class="legend-item">
            <div class="legend-icon all-levels"></div>
            <span>Wszystkie poziomy</span>
        </div>
    </div>

    <script>
        /* Resort count and distances are updated after markers are created
           (we build markers later so we update the UI once everything is ready) */

        const rybnikCoords = [50.0971, 18.5463];
        const map = L.map('map').setView([49.8, 19.2], 9);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors',
            maxZoom: 18
        }).addTo(map);

        L.marker(rybnikCoords, {
            icon: L.divIcon({
                className: 'custom-marker',
                html: '<div style="background:#e74c3c;width:25px;height:25px;border-radius:50%;border:3px solid white;box-shadow:0 2px 5px rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:16px;">üìç</div>',
                iconSize: [25, 25],
                iconAnchor: [12, 12]
            })
        }).addTo(map).bindPopup('<b>Rybnik</b><br>Twoja lokalizacja');

        const skiResorts = [
            {
                name: 'Szczyrk Mountain Resort',
                lat: 49.7167,
                lng: 19.0333,
                level: 'all-levels',
                distance: 65,
                description: 'Najwiƒôkszy o≈õrodek narciarski w Polsce. 37 km tras, 10 wyciƒÖg√≥w.',
                slopes: '37 km tras, 10 wyciƒÖg√≥w',
                price: '180-220 PLN',
                priceNote: 'dzie≈Ñ doros≈Çy (ceny dynamiczne)',
                website: 'https://www.szczyrkowski.pl',
                trailMap: 'https://www.szczyrkowski.pl'
            },
            {
                name: 'Kasprowy Wierch',
                lat: 49.2323,
                lng: 19.9817,
                level: 'advanced',
                distance: 165,
                description: 'Najwy≈ºszy o≈õrodek w Polsce (1987m). Trasy dla zaawansowanych narciarzy.',
                slopes: '3.3 km tras, 4 wyciƒÖgi',
                price: '199 PLN',
                priceNote: 'dzie≈Ñ doros≈Çy + kolejka',
                website: 'https://www.pkl.pl/kasprowy-wierch',
                trailMap: 'https://www.pkl.pl/kasprowy-wierch/mapa'
            },
            {
                name: 'Nosal - Zakopane',
                lat: 49.2745,
                lng: 19.9640,
                level: 'beginner',
                distance: 167,
                description: 'Idealny dla rodzin i poczƒÖtkujƒÖcych. Sztuczne na≈õnie≈ºanie.',
                slopes: '1.2 km tras, 6 wyciƒÖg√≥w',
                price: '140-160 PLN',
                priceNote: 'dzie≈Ñ doros≈Çy',
                website: 'https://nosal.pl',
                trailMap: 'https://nosal.pl/mapa-stok√≥w'
            },
            {
                name: 'Polana Szymoszkowa',
                lat: 49.2856,
                lng: 19.9523,
                level: 'intermediate',
                distance: 170,
                description: 'Nowoczesne wyciƒÖgi krzese≈Çkowe. Kids Park dla dzieci.',
                slopes: '4 km tras, 3 wyciƒÖgi',
                price: '150-180 PLN',
                priceNote: 'dzie≈Ñ doros≈Çy',
                website: 'https://szymoszkowa.pl',
                trailMap: 'https://szymoszkowa.pl/trasy-narciarskie-zakopane/'
            },
            {
                name: 'Harenda - Zakopane',
                lat: 49.2923,
                lng: 20.0012,
                level: 'intermediate',
                distance: 175,
                description: 'Trasy FIS, snowpark i lodowisko. Zr√≥≈ºnicowane trasy.',
                slopes: '4 km tras, 7 wyciƒÖg√≥w',
                price: '140-170 PLN',
                priceNote: 'dzie≈Ñ doros≈Çy',
                website: 'https://www.harendazakopane.pl',
                trailMap: 'https://www.harendazakopane.pl/'
            },
            {
                name: 'Guba≈Ç√≥wka',
                lat: 49.2978,
                lng: 19.9389,
                level: 'beginner',
                distance: 168,
                description: 'Kolejka linowa z centrum. ≈Åatwe trasy i snowpark.',
                slopes: '0.3 km tras, 2 wyciƒÖgi',
                price: '85-100 PLN',
                priceNote: 'dzie≈Ñ + kolejka',
                website: 'https://www.pkl.pl/gubalowka',
                trailMap: 'https://www.pkl.pl/gubalowka/mapa'
            },
            {
                name: 'Bia≈Çka Tatrza≈Ñska - Kotelnica',
                lat: 49.3997,
                lng: 20.1117,
                level: 'all-levels',
                distance: 185,
                description: '25 tras r√≥≈ºnej trudno≈õci. Czƒô≈õƒá karnetu Tatry Super Ski.',
                slopes: '14 km tras, 21 wyciƒÖg√≥w',
                price: '160-190 PLN',
                priceNote: 'dzie≈Ñ doros≈Çy',
                website: 'https://bialkatatrzanska.pl',
                trailMap: 'https://bialkatatrzanska.pl/mapa-tras'
            },
            {
                name: 'Zieleniec Ski Arena',
                lat: 50.3258,
                lng: 16.3519,
                level: 'all-levels',
                distance: 120,
                description: 'Jeden z najwiƒôkszych o≈õrodk√≥w w Polsce. 23 km tras.',
                slopes: '23 km tras, 31 wyciƒÖg√≥w',
                price: '140-180 PLN',
                priceNote: 'dzie≈Ñ doros≈Çy (ceny dynamiczne)',
                website: 'https://zieleniec.pl',
                trailMap: 'https://zieleniec.pl/zima/mapa'
            },
            {
                name: 'Czarna G√≥ra Resort',
                lat: 50.3000,
                lng: 16.8333,
                level: 'all-levels',
                distance: 145,
                description: 'Strefa czystego powietrza. 20 tras, jazda nocna do 22:00.',
                slopes: '14 km tras, 13 wyciƒÖg√≥w',
                price: '140-170 PLN',
                priceNote: 'dzie≈Ñ doros≈Çy (7h)',
                website: 'https://czarnagora.pl',
                trailMap: 'https://czarnagora.pl/mapa-zimowa/'
            },
            {
                name: 'Pilsko - Korbiel√≥w',
                lat: 49.5833,
                lng: 19.1000,
                level: 'intermediate',
                distance: 55,
                description: 'Wysokog√≥rskie trasy w Beskidach. Piƒôkne widoki.',
                slopes: '4.3 km tras, 5 wyciƒÖg√≥w',
                price: '130-150 PLN',
                priceNote: 'dzie≈Ñ doros≈Çy',
                website: 'https://pilsko.com.pl',
                trailMap: 'https://korbielow.net/pilsko-trasy-wyciagi/'
            },
            {
                name: 'Wis≈Ça - Sto≈ºek',
                lat: 49.6500,
                lng: 18.8500,
                level: 'intermediate',
                distance: 35,
                description: 'O≈õrodek w sercu Beskidu ≈ölƒÖskiego. R√≥≈ºnorodne trasy.',
                slopes: '3.5 km tras, 6 wyciƒÖg√≥w',
                price: '110-140 PLN',
                priceNote: 'dzie≈Ñ doros≈Çy',
                website: 'https://wisla.pl',
                trailMap: 'https://wisla.pl'
            },
            {
                name: 'Brenna - Narciarska',
                lat: 49.7167,
                lng: 18.9000,
                level: 'beginner',
                distance: 50,
                description: 'Rodzinny o≈õrodek. ≈Åagodne stoki dla poczƒÖtkujƒÖcych.',
                slopes: '2 km tras, 4 wyciƒÖgi',
                price: '100-120 PLN',
                priceNote: 'dzie≈Ñ doros≈Çy',
                website: 'https://www.brenna.org.pl/',
                trailMap: 'https://turysta.brenna.org.pl/'
            },
            {
                name: 'Zawoja - Mosorny Gro≈Ñ',
                lat: 49.6333,
                lng: 19.5333,
                level: 'intermediate',
                distance: 95,
                description: 'Czƒô≈õƒá karnetu Tatry Super Ski. Widoki na BabiƒÖ G√≥rƒô.',
                slopes: '3 km tras, 5 wyciƒÖg√≥w',
                price: '100-130 PLN',
                priceNote: 'dzie≈Ñ doros≈Çy',
                website: 'https://www.pkl.pl/mosorny-gron',
                trailMap: 'https://www.pkl.pl/mosorny-gron/mapa'
            },
            {
                name: 'Korbiel√≥w - Ma≈Çy Rachowiec',
                lat: 49.5917,
                lng: 19.0833,
                level: 'beginner',
                distance: 52,
                description: 'Mniejszy, rodzinny o≈õrodek w ≈ªywieckiem.',
                slopes: '1.5 km tras, 3 wyciƒÖgi',
                price: '80-100 PLN',
                priceNote: 'dzie≈Ñ doros≈Çy',
                website: 'https://korbielow.net',
                trailMap: 'https://korbielow.net/pilsko-trasy-wyciagi/'
            },
            {
                name: 'Szyndzielnia - Bielsko',
                lat: 49.8000,
                lng: 19.0333,
                level: 'intermediate',
                distance: 45,
                description: 'Najbli≈ºszy wiƒôkszy o≈õrodek od Rybnika. Kolejka linowa.',
                slopes: '3.2 km tras, 5 wyciƒÖg√≥w',
                price: '100-130 PLN',
                priceNote: 'dzie≈Ñ doros≈Çy + kolejka',
                website: 'https://kolej-szyndzielnia.pl/',
                trailMap: 'https://kolej-szyndzielnia.pl/kolej-gondolowa/'
            }
            ,
            {
                name: 'Ustro≈Ñ - Czantoria',
                lat: 49.678611,
                lng: 18.804444,
                level: 'all-levels',
                distance: 51,
                description: 'Popularny o≈õrodek z kolejkƒÖ krzese≈ÇkowƒÖ, wie≈ºƒÖ widokowƒÖ i trasami dla rodzin.',
                slopes: 'kilka tras zjazdowych, wyciƒÖgi, nartostrady',
                price: '100-130 PLN',
                priceNote: 'dzie≈Ñ doros≈Çy',
                website: 'https://wiezaczantoria.pl/',
                trailMap: 'https://wiezaczantoria.pl/wieza/'
            },
            {
                name: 'Zwardo≈Ñ Ski',
                lat: 49.5038889,
                lng: 18.9758333,
                level: 'intermediate',
                distance: 73,
                description: 'Tradycyjna stacja narciarska w Beskidzie ≈ªywieckim ‚Äî kilka wyciƒÖg√≥w i trasy rodzinne.',
                slopes: 'kilka wyciƒÖg√≥w, trasy rodzinne',
                price: '90-120 PLN',
                priceNote: 'dzie≈Ñ doros≈Çy',
                website: 'http://www.zwardon.prv.pl/',
                trailMap: 'https://zwardon.prv.pl/zima.html'
            },
            {
                name: 'Wis≈Ça - Cie≈Ñk√≥w',
                lat: 49.654167,
                lng: 18.860833,
                level: 'intermediate',
                distance: 54,
                description: 'Stacja narciarska w obrƒôbie Wis≈Çy ‚Äî wygodne dojazdy, trasy dla rodzin.',
                slopes: 'kilka tras, wyciƒÖgi talerzykowe',
                price: '100-130 PLN',
                priceNote: 'dzie≈Ñ doros≈Çy',
                website: 'https://wisla.pl',
                trailMap: 'https://wisla.pl'
            },
            {
                name: 'Jaworzyna Krynicka',
                lat: 49.4179444,
                lng: 20.8955,
                level: 'all-levels',
                distance: 186,
                description: 'Du≈ºy o≈õrodek w Beskidzie SƒÖdeckim z gondolƒÖ i rozbudowanƒÖ infrastrukturƒÖ narciarskƒÖ.',
                slopes: 'ok. 14 km tras, kolej gondolowa, kilka wyciƒÖg√≥w',
                price: '160-200 PLN',
                priceNote: 'dzie≈Ñ doros≈Çy (kolej gondolowa osobno)',
                website: 'https://jaworzynakrynicka.pl',
                trailMap: 'https://jaworzynakrynicka.pl'
            }
        ];

        function getMarkerColor(level) {
            switch(level) {
                case 'beginner': return '#27ae60';
                case 'intermediate': return '#3498db';
                case 'advanced': return '#e74c3c';
                case 'all-levels': return '#9b59b6';
                default: return '#95a5a6';
            }
        }

        function getLevelBadge(level) {
            const labels = {
                'beginner': 'PoczƒÖtkujƒÖcy',
                'intermediate': '≈öredniozaawansowani',
                'advanced': 'Zaawansowani',
                'all-levels': 'Wszystkie poziomy'
            };
            return `<span class="level ${level}">${labels[level]}</span>`;
        }

        // Utility: haversine distance in km
        function haversineKm(lat1, lon1, lat2, lon2) {
            const toRad = x => x * Math.PI / 180;
            const R = 6371; // km
            const dLat = toRad(lat2 - lat1);
            const dLon = toRad(lon2 - lon1);
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Use a simple layer group for markers (clustering removed)
        const markersGroup = L.layerGroup();
        const markerList = [];

        skiResorts.forEach(resort => {
            const color = getMarkerColor(resort.level);

            const customIcon = L.divIcon({
                className: 'custom-marker',
                html: `<div style="
                    background-color: ${color};
                    width: 28px;
                    height: 28px;
                    border-radius: 50%;
                    border: 3px solid white;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
                "></div>`,
                iconSize: [28, 28],
                iconAnchor: [14, 14]
            });

            const distKm = Math.round(haversineKm(rybnikCoords[0], rybnikCoords[1], resort.lat, resort.lng));
            // prepare buttons with safe attributes and accessibility
            const websiteBtn = (resort.website && String(resort.website).startsWith('http'))
                ? `<a href="${resort.website}" target="_blank" rel="noopener noreferrer" class="website-btn" aria-label="Otw√≥rz oficjalnƒÖ stronƒô ${resort.name}">üåê Strona</a>`
                : `<a href="#" class="website-btn" aria-disabled="true" style="opacity:.6;pointer-events:none;">üåê Strona</a>`;

            const mapBtn = (resort.trailMap && String(resort.trailMap).startsWith('http'))
                ? `<a href="${resort.trailMap}" target="_blank" rel="noopener noreferrer" class="map-btn" aria-label="Mapa tras ${resort.name}">üó∫Ô∏è Mapa tras</a>`
                : `<a href="#" class="map-btn" aria-disabled="true" style="opacity:.6;pointer-events:none;">üó∫Ô∏è Mapa tras</a>`;

            const popupContent = `
                <div class="popup-content">
                    <h3>‚õ∑Ô∏è ${resort.name}</h3>
                    ${getLevelBadge(resort.level)}
                    <div class="distance">üìç ${distKm} km od Rybnika</div>
                    <div class="info-row">
                        <strong>üìè Trasy:</strong> ${resort.slopes}
                    </div>
                    <div class="price-box">
                        <div class="price">üí∞ ${resort.price}</div>
                        <div class="price-label">${resort.priceNote}</div>
                    </div>
                    <p style="font-size:12px;color:#555;margin:8px 0;">${resort.description}</p>
                    <div class="btn-group">
                        ${websiteBtn}
                        ${mapBtn}
                    </div>
                </div>
            `;

            const marker = L.marker([resort.lat, resort.lng], { icon: customIcon });
            marker.bindPopup(popupContent, { maxWidth: 320, className: 'custom-popup' });
            marker.resort = resort; // attach data for filtering
            marker.resort._distanceKm = distKm;
            markerList.push(marker);
            markersGroup.addLayer(marker);
        });

        // Add the cluster group to the map
        map.addLayer(markersGroup);

        // Draw the 200 km circle around Rybnik
        const circle = L.circle(rybnikCoords, {
            color: '#e74c3c',
            fillColor: '#e74c3c',
            fillOpacity: 0.08,
            radius: 200000
        }).addTo(map);

        // Fit bounds to markers + Rybnik
        const allPoints = [...skiResorts.map(r => [r.lat, r.lng]), rybnikCoords];
        const bounds = L.latLngBounds(allPoints);
        map.fitBounds(bounds.pad(0.08), { padding: [30, 30] });

        // Update resort count now that markers are built
        const resortCountEl = document.getElementById('resort-count');
        if (resortCountEl) resortCountEl.textContent = `üìç ${skiResorts.length} O≈õrodk√≥w`;

        // Search / filter implementation
        const searchEl = document.getElementById('search');
        if (searchEl) {
            searchEl.addEventListener('input', function(e) {
                const q = String(e.target.value || '').trim().toLowerCase();
                markersGroup.clearLayers();
                const filtered = markerList.filter(m => {
                    if (!q) return true;
                    const r = m.resort;
                    return (r.name && r.name.toLowerCase().includes(q)) ||
                           (r.description && r.description.toLowerCase().includes(q)) ||
                           (r.slopes && r.slopes.toLowerCase().includes(q));
                });
                if (filtered.length) filtered.forEach(m => markersGroup.addLayer(m));
                // update count to show matched count when filtering
                if (resortCountEl) resortCountEl.textContent = q ? `üîé ${filtered.length} wynik√≥w` : `üìç ${skiResorts.length} O≈õrodk√≥w`;
            });
        }
    </script>
</body>
</html>
